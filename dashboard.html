<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtroZ ¬∑ Sistema Visceral de An√°lisis Municipal</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@200;400;700&display=swap');

        :root {
            --atroz-red-900: #3A0E0E;
            --atroz-red-700: #7A0F0F;
            --atroz-red-500: #C41E3A;
            --atroz-blood: #8B0000;
            --atroz-blue-900: #04101A;
            --atroz-blue-700: #102F56;
            --atroz-blue-electric: #00D4FF;
            --atroz-green-900: #0B231B;
            --atroz-green-300: #BFEFCB;
            --atroz-green-toxic: #39FF14;
            --atroz-copper-700: #7B3F1D;
            --atroz-copper-500: #B2642E;
            --atroz-copper-oxide: #17A589;
            --ink: #E5E7EB;
            --bg: #0A0A0A;
            --membrane: rgba(122, 15, 15, 0.1);
            --transition-slow: 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--ink);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            position: relative;
            cursor: crosshair;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 50%, var(--membrane) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(16, 47, 86, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(11, 35, 27, 0.05) 0%, transparent 50%);
            animation: organicPulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes organicPulse {

            0%,
            100% {
                transform: rotate(0deg) scale(1);
                opacity: 0.7;
            }

            25% {
                transform: rotate(90deg) scale(1.1);
                opacity: 0.8;
            }

            50% {
                transform: rotate(180deg) scale(0.95);
                opacity: 0.6;
            }

            75% {
                transform: rotate(270deg) scale(1.05);
                opacity: 0.9;
            }
        }

        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 50px, var(--atroz-red-700) 50px, var(--atroz-red-700) 51px),
                repeating-linear-gradient(90deg, transparent, transparent 50px, var(--atroz-blue-700) 50px, var(--atroz-blue-700) 51px);
            animation: neuralFlow 20s linear infinite;
            z-index: -1;
        }

        @keyframes neuralFlow {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .atlas-container {
            height: 100vh;
            display: grid;
            grid-template-rows: 80px 1fr 100px;
            position: relative;
            z-index: 10;
        }

        .header {
            background: linear-gradient(180deg, rgba(4, 16, 26, 0.9) 0%, transparent 100%);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            position: relative;
            z-index: 100;
            border-bottom: 1px solid transparent;
            background-image: linear-gradient(90deg, transparent, var(--atroz-copper-500), transparent);
            background-position: 0% 100%;
            background-repeat: no-repeat;
            background-size: 100% 1px;
            animation: scanline 3s linear infinite;
        }

        @keyframes scanline {
            0% {
                background-position: -100% 100%;
            }

            100% {
                background-position: 200% 100%;
            }
        }

        .logo {
            font-size: 24px;
            font-weight: 200;
            letter-spacing: 8px;
            text-transform: uppercase;
            position: relative;
            background: linear-gradient(90deg, var(--ink), var(--atroz-green-toxic));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.3);
        }

        .logo::before {
            content: 'ATROZ';
            position: absolute;
            left: 0;
            top: 0;
            color: var(--atroz-red-700);
            animation: glitch 5s infinite;
            z-index: -1;
            opacity: 0.8;
        }

        @keyframes glitch {

            0%,
            100% {
                clip-path: inset(0 0 0 0);
                transform: translate(0);
            }

            5% {
                clip-path: inset(15% 0 30% 0);
                transform: translate(5px, 3px);
            }

            10% {
                clip-path: inset(30% 0 15% 0);
                transform: translate(-3px, -5px);
            }

            15% {
                clip-path: inset(10% 0 40% 0);
                transform: translate(2px, -2px);
            }

            20% {
                clip-path: inset(40% 0 10% 0);
                transform: translate(-5px, 5px);
            }

            50% {
                clip-path: inset(0 0 0 0);
                transform: translate(0);
            }
        }

        .nav-pills {
            display: flex;
            gap: 2px;
            background: rgba(0, 0, 0, 0.5);
            padding: 4px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(178, 100, 46, 0.2);
        }

        .nav-pill {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--ink);
            cursor: pointer;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-radius: 20px;
            transition: var(--transition-slow);
            position: relative;
            overflow: hidden;
        }

        .nav-pill::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--atroz-copper-oxide);
            transition: var(--transition-slow);
            transform: translate(-50%, -50%);
        }

        .nav-pill:hover::before,
        .nav-pill.active::before {
            width: 100%;
            height: 100%;
            border-radius: 20px;
        }

        .nav-pill.active {
            color: var(--bg);
        }

        .nav-pill span {
            position: relative;
            z-index: 1;
        }

        .viz-container {
            position: relative;
            overflow: hidden;
            display: flex;
        }

        .constellation-map {
            flex: 1;
            position: relative;
            background: radial-gradient(ellipse at center, rgba(4, 16, 26, 0.5) 0%, transparent 70%);
        }

        .constellation-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .pdet-node {
            position: absolute;
            width: 120px;
            height: 120px;
            cursor: pointer;
            transition: var(--transition-slow);
            z-index: 20;
            transform-origin: center;
        }

        .pdet-core {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotateZ(0deg);
            }

            50% {
                transform: translateY(-10px) rotateZ(2deg);
            }
        }

        .pdet-hexagon {
            width: 100%;
            height: 100%;
            position: absolute;
            background: var(--atroz-red-900);
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            opacity: 0.8;
            transition: var(--transition-slow);
        }

        .pdet-node:hover .pdet-hexagon {
            background: var(--atroz-copper-500);
            transform: scale(1.1);
            box-shadow: 0 0 50px rgba(178, 100, 46, 0.8);
        }

        .pdet-inner {
            position: absolute;
            top: 10%;
            left: 10%;
            width: 80%;
            height: 80%;
            background: rgba(0, 0, 0, 0.8);
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .pdet-score {
            font-size: 24px;
            font-weight: 700;
            color: var(--atroz-green-toxic);
            text-shadow: 0 0 10px currentColor;
        }

        .pdet-name {
            font-size: 8px;
            text-align: center;
            margin-top: 4px;
            letter-spacing: 1px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .pdet-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            border: 1px solid var(--atroz-copper-500);
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            transform: translate(-50%, -50%);
            animation: pulsate 2s ease-out infinite;
        }

        @keyframes pulsate {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.8;
            }

            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        .neural-connection {
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--atroz-blue-electric), transparent);
            height: 1px;
            transform-origin: left center;
            animation: dataFlow 3s linear infinite;
            pointer-events: none;
        }

        @keyframes dataFlow {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 0;
            }
        }

        .data-panel {
            width: 400px;
            background: linear-gradient(180deg, rgba(4, 16, 26, 0.8) 0%, rgba(10, 10, 10, 0.9) 100%);
            border-left: 1px solid var(--atroz-copper-700);
            padding: 30px;
            overflow-y: auto;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .data-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, var(--atroz-copper-500), transparent, var(--atroz-copper-500));
            animation: verticalScan 4s linear infinite;
        }

        @keyframes verticalScan {

            0%,
            100% {
                transform: translateY(-100%);
            }

            50% {
                transform: translateY(100%);
            }
        }

        .level-viz {
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInUp 0.8s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }

            from {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        .macro-phylogram {
            width: 100%;
            height: 200px;
            position: relative;
            margin: 20px 0;
        }

        .phylo-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, var(--atroz-copper-oxide), transparent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: rotate 20s linear infinite;
        }

        .phylo-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 1px solid rgba(178, 100, 46, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .phylo-ring:nth-child(1) {
            width: 120px;
            height: 120px;
            animation: counter-rotate 15s linear infinite;
        }

        .phylo-ring:nth-child(2) {
            width: 160px;
            height: 160px;
            animation: rotate 20s linear infinite;
        }

        .phylo-ring:nth-child(3) {
            width: 200px;
            height: 200px;
            animation: counter-rotate 25s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @keyframes counter-rotate {
            from {
                transform: translate(-50%, -50%) rotate(360deg);
            }

            to {
                transform: translate(-50%, -50%) rotate(0deg);
            }
        }

        .phylo-branch {
            position: absolute;
            background: var(--atroz-green-toxic);
            height: 1px;
            transform-origin: left center;
        }

        .meso-mesh {
            width: 100%;
            height: 250px;
            position: relative;
            margin: 20px 0;
        }

        .mesh-cluster {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(16, 47, 86, 0.8), transparent);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-slow);
        }

        .mesh-cluster::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid var(--atroz-blue-electric);
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        .mesh-cluster:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 40px var(--atroz-blue-electric);
        }

        .cluster-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--atroz-blue-electric);
            text-shadow: 0 0 20px currentColor;
        }

        .cluster-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            white-space: nowrap;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .micro-helix {
            width: 100%;
            height: 300px;
            position: relative;
            margin: 20px 0;
            perspective: 600px;
        }

        .helix-strand {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: helixRotate 20s linear infinite;
        }

        @keyframes helixRotate {
            from {
                transform: rotateY(0deg);
            }

            to {
                transform: rotateY(360deg);
            }
        }

        .helix-point {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--atroz-green-toxic);
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
        }

        .helix-connector {
            position: absolute;
            width: 100px;
            height: 1px;
            background: linear-gradient(90deg, var(--atroz-green-toxic), transparent, var(--atroz-green-toxic));
            left: 50%;
            transform: translateX(-50%);
        }

        .question-card {
            position: absolute;
            background: rgba(11, 35, 27, 0.8);
            border: 1px solid var(--atroz-green-300);
            padding: 8px;
            border-radius: 4px;
            font-size: 9px;
            cursor: pointer;
            transition: var(--transition-fast);
            backdrop-filter: blur(5px);
        }

        .question-card:hover {
            transform: scale(1.1) translateZ(20px);
            box-shadow: 0 10px 30px rgba(57, 255, 20, 0.3);
            z-index: 100;
        }

        .q-score {
            display: inline-block;
            padding: 2px 6px;
            background: var(--atroz-green-toxic);
            color: var(--bg);
            border-radius: 2px;
            font-weight: 700;
            margin-left: 5px;
        }

        .evidence-stream {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(180deg, transparent, rgba(4, 16, 26, 0.9));
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 0 40px;
            overflow: hidden;
            z-index: 50;
        }

        .evidence-ticker {
            display: flex;
            gap: 40px;
            animation: ticker 30s linear infinite;
        }

        @keyframes ticker {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .evidence-item {
            white-space: nowrap;
            font-size: 11px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .evidence-dot {
            width: 4px;
            height: 4px;
            background: var(--atroz-copper-500);
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        .muni-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .muni-overlay.active {
            display: flex;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .overlay-content {
            width: 90%;
            max-width: 1200px;
            height: 80vh;
            background: var(--bg);
            border: 1px solid var(--atroz-copper-700);
            border-radius: 0;
            position: relative;
            overflow: hidden;
        }

        .overlay-header {
            height: 60px;
            background: linear-gradient(90deg, var(--atroz-red-900), var(--atroz-blue-900));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
        }

        .overlay-body {
            height: calc(100% - 60px);
            padding: 30px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }

        .viz-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(178, 100, 46, 0.2);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .viz-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--membrane), transparent);
            animation: organicMove 10s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes organicMove {

            0%,
            100% {
                transform: translate(0, 0);
            }

            50% {
                transform: translate(20px, 20px);
            }
        }

        .radar-container {
            width: 200px;
            height: 200px;
            position: relative;
            margin: 0 auto;
        }

        .radar-web {
            position: absolute;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .radar-polygon {
            fill: none;
            stroke: var(--atroz-copper-500);
            stroke-width: 0.5;
            opacity: 0.3;
        }

        .radar-data {
            fill: var(--atroz-green-toxic);
            fill-opacity: 0.3;
            stroke: var(--atroz-green-toxic);
            stroke-width: 2;
            filter: blur(0.5px);
            animation: radarPulse 3s ease-in-out infinite;
        }

        @keyframes radarPulse {

            0%,
            100% {
                fill-opacity: 0.3;
            }

            50% {
                fill-opacity: 0.5;
            }
        }

        .rec-pill {
            background: linear-gradient(135deg, var(--atroz-red-900), var(--atroz-red-700));
            border-left: 3px solid var(--atroz-blood);
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
            font-size: 11px;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .rec-pill:hover {
            transform: translateX(10px);
            box-shadow: -10px 0 20px rgba(139, 0, 0, 0.5);
        }

        .rec-priority {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 8px;
            color: var(--atroz-copper-500);
            letter-spacing: 1px;
        }

        .close-overlay {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid var(--atroz-red-700);
            color: var(--ink);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            font-size: 20px;
        }

        .close-overlay:hover {
            background: var(--atroz-red-700);
            transform: rotate(90deg);
        }

        .comparison-matrix {
            position: fixed;
            bottom: 120px;
            right: 20px;
            width: 300px;
            background: rgba(4, 16, 26, 0.9);
            border: 1px solid var(--atroz-copper-700);
            padding: 15px;
            backdrop-filter: blur(10px);
            display: none;
            z-index: 100;
        }

        .comparison-matrix.active {
            display: block;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(0);
            }
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .matrix-cell {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(178, 100, 46, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .matrix-cell:hover {
            background: var(--atroz-copper-oxide);
            transform: scale(1.1);
            z-index: 10;
        }

        .loading-dna {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 2000;
        }

        .loading-dna.active {
            display: block;
        }

        .dna-strand {
            width: 60px;
            height: 60px;
            position: relative;
            animation: dnaRotate 2s linear infinite;
        }

        @keyframes dnaRotate {
            from {
                transform: rotateY(0deg);
            }

            to {
                transform: rotateY(360deg);
            }
        }

        .dna-bar {
            position: absolute;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--atroz-green-toxic), var(--atroz-copper-500));
            left: 50%;
            transform: translateX(-50%);
        }

        .dna-bar:nth-child(1) {
            transform: translateX(-50%) rotateY(0deg) translateZ(20px);
        }

        .dna-bar:nth-child(2) {
            transform: translateX(-50%) rotateY(60deg) translateZ(20px);
        }

        .dna-bar:nth-child(3) {
            transform: translateX(-50%) rotateY(120deg) translateZ(20px);
        }

        .dna-bar:nth-child(4) {
            transform: translateX(-50%) rotateY(180deg) translateZ(20px);
        }

        .dna-bar:nth-child(5) {
            transform: translateX(-50%) rotateY(240deg) translateZ(20px);
        }

        .dna-bar:nth-child(6) {
            transform: translateX(-50%) rotateY(300deg) translateZ(20px);
        }

        .control-interface {
            position: fixed;
            top: 100px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 50;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--atroz-copper-700);
            color: var(--ink);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            font-size: 10px;
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--atroz-copper-oxide);
            transition: left 0.3s;
        }

        .control-btn:hover::before {
            left: 0;
        }

        .control-btn span {
            position: relative;
            z-index: 1;
        }

        .radial-menu {
            position: fixed;
            width: 200px;
            height: 200px;
            display: none;
            z-index: 1000;
        }

        .radial-menu.active {
            display: block;
        }

        .radial-item {
            position: absolute;
            width: 40px;
            height: 40px;
            background: var(--atroz-red-900);
            border: 1px solid var(--atroz-copper-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            transition: var(--transition-fast);
            transform-origin: center;
        }

        .radial-item:hover {
            background: var(--atroz-copper-500);
            transform: scale(1.2);
        }

        .timeline {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--atroz-copper-700);
            border-radius: 10px;
            display: none;
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        .timeline.active {
            display: block;
        }

        .timeline-scrubber {
            position: absolute;
            width: 10px;
            height: 30px;
            background: var(--atroz-copper-500);
            top: -5px;
            left: 0;
            cursor: grab;
            border-radius: 2px;
        }

        .timeline-years {
            position: absolute;
            bottom: -20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            opacity: 0.7;
        }

        body.focus-mode .pdet-node:not(.focused),
        body.focus-mode .mesh-cluster:not(.focused),
        body.focus-mode .question-card:not(.focused) {
            opacity: 0.2;
            filter: blur(2px);
        }

        .tooltip {
            position: fixed;
            background: rgba(4, 16, 26, 0.9);
            border: 1px solid var(--atroz-copper-500);
            padding: 10px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            backdrop-filter: blur(5px);
            max-width: 300px;
        }

        .tooltip.active {
            opacity: 1;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background: rgba(4, 16, 26, 0.9);
            border: 1px solid var(--atroz-copper-500);
            backdrop-filter: blur(10px);
            transform: translateX(100%);
            transition: transform 0.5s;
            z-index: 2000;
            max-width: 300px;
        }

        .notification.active {
            transform: translateX(0);
        }

        @media (max-width: 1200px) {
            .data-panel {
                width: 350px;
            }

            .overlay-body {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 900px) {
            .viz-container {
                flex-direction: column;
            }

            .data-panel {
                width: 100%;
                height: 40%;
                border-left: none;
                border-top: 1px solid var(--atroz-copper-700);
            }

            .header {
                padding: 0 20px;
            }

            .nav-pills {
                flex-wrap: wrap;
                justify-content: center;
            }

            .overlay-body {
                grid-template-columns: 1fr;
            }
        }

        .performance-optimized {
            will-change: transform, opacity;
            backface-visibility: hidden;
        }

        /* ADMIN LAYER STYLES */
        .admin-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(4, 16, 26, 0.95);
            backdrop-filter: blur(20px);
            z-index: 9999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: var(--ink);
            font-family: 'JetBrains Mono', monospace;
        }

        .admin-layer.active {
            display: flex;
            opacity: 1;
        }

        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            width: 100%;
            height: 100%;
        }

        .admin-sidebar {
            border-right: 1px solid var(--atroz-red-700);
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .admin-header {
            color: var(--atroz-red-500);
            font-size: 14px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-transform: uppercase;
            border-bottom: 1px solid var(--atroz-red-900);
            padding-bottom: 10px;
        }

        .admin-nav-item {
            padding: 10px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
            font-size: 11px;
            color: var(--ink);
            opacity: 0.7;
        }

        .admin-nav-item:hover,
        .admin-nav-item.active {
            border-color: var(--atroz-red-700);
            background: rgba(122, 15, 15, 0.1);
            opacity: 1;
            padding-left: 15px;
        }

        .admin-content {
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .admin-panel {
            display: none;
            height: 100%;
        }

        .admin-panel.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .terminal-window {
            background: #000;
            border: 1px solid var(--atroz-green-toxic);
            padding: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            height: 400px;
            overflow-y: auto;
            color: var(--atroz-green-toxic);
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.1);
        }

        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid rgba(57, 255, 20, 0.1);
            padding-bottom: 2px;
        }

        .log-entry.error {
            color: var(--atroz-red-500);
        }

        .log-entry.info {
            color: var(--atroz-blue-electric);
        }

        .log-entry.success {
            color: var(--atroz-green-toxic);
        }

        .upload-zone {
            border: 2px dashed var(--atroz-copper-500);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(178, 100, 46, 0.05);
        }

        .upload-zone:hover {
            background: rgba(178, 100, 46, 0.1);
            border-color: var(--atroz-copper-oxide);
            box-shadow: 0 0 30px rgba(178, 100, 46, 0.2);
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--atroz-blue-700);
            padding: 15px;
        }

        .metric-value {
            font-size: 24px;
            color: var(--atroz-blue-electric);
            font-weight: bold;
        }

        .metric-label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.7;
        }
    </style>
    <!-- Socket.IO disabled for standalone operation - uncomment for live server mode
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    -->
</head>

<body>
    <div class="neural-bg"></div>
    <canvas id="particle-canvas"></canvas>

    <div class="atlas-container">
        <header class="header">
            <div class="logo">ATROZ</div>
            <nav class="nav-pills">
                <button class="nav-pill active" data-view="constellation">
                    <span>CONSTELACI√ìN</span>
                </button>
                <button class="nav-pill" data-view="macro">
                    <span>MACRO</span>
                </button>
                <button class="nav-pill" data-view="meso">
                    <span>MESO</span>
                </button>
                <button class="nav-pill" data-view="micro">
                    <span>MICRO</span>
                </button>
            </nav>
        </header>

        <div class="viz-container">
            <div class="constellation-map" id="constellationMap">
                <canvas class="constellation-canvas" id="neuralCanvas"></canvas>
                <div id="pdetNodes"></div>
            </div>

            <div class="data-panel" id="dataPanel">
                <div class="level-viz" style="animation-delay: 0s;">
                    <h3 style="font-size: 11px; letter-spacing: 3px; opacity: 0.5; margin-bottom: 10px;">NIVEL MACRO
                    </h3>
                    <div class="macro-phylogram">
                        <div class="phylo-ring"></div>
                        <div class="phylo-ring"></div>
                        <div class="phylo-ring"></div>
                        <div class="phylo-center">
                            <span style="font-size: 24px; font-weight: 700;">87%</span>
                        </div>
                        <svg style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;">
                            <line class="phylo-branch" x1="50%" y1="50%" x2="80%" y2="20%"
                                stroke="var(--atroz-green-toxic)" stroke-width="1" opacity="0.5" />
                            <line class="phylo-branch" x1="50%" y1="50%" x2="20%" y2="30%"
                                stroke="var(--atroz-green-toxic)" stroke-width="1" opacity="0.5" />
                            <line class="phylo-branch" x1="50%" y1="50%" x2="70%" y2="80%"
                                stroke="var(--atroz-green-toxic)" stroke-width="1" opacity="0.5" />
                        </svg>
                    </div>
                </div>

                <div class="level-viz" style="animation-delay: 0.2s;">
                    <h3 style="font-size: 11px; letter-spacing: 3px; opacity: 0.5; margin-bottom: 10px;">NIVEL MESO ¬∑
                        CLUSTERS</h3>
                    <div class="meso-mesh" id="mesoMesh">
                        <div class="mesh-cluster" style="top: 20%; left: 10%;">
                            <span class="cluster-value">72</span>
                            <span class="cluster-label">GOBERNANZA</span>
                        </div>
                        <div class="mesh-cluster" style="top: 10%; right: 20%;">
                            <span class="cluster-value">68</span>
                            <span class="cluster-label">SOCIAL</span>
                        </div>
                        <div class="mesh-cluster" style="bottom: 30%; left: 30%;">
                            <span class="cluster-value">81</span>
                            <span class="cluster-label">ECON√ìMICO</span>
                        </div>
                        <div class="mesh-cluster" style="bottom: 10%; right: 10%;">
                            <span class="cluster-value">76</span>
                            <span class="cluster-label">AMBIENTAL</span>
                        </div>
                        <svg
                            style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none;">
                            <line x1="35%" y1="45%" x2="60%" y2="35%" stroke="var(--atroz-blue-electric)"
                                stroke-width="0.5" opacity="0.3" />
                            <line x1="35%" y1="45%" x2="55%" y2="65%" stroke="var(--atroz-blue-electric)"
                                stroke-width="0.5" opacity="0.3" />
                            <line x1="70%" y1="35%" x2="75%" y2="75%" stroke="var(--atroz-blue-electric)"
                                stroke-width="0.5" opacity="0.3" />
                        </svg>
                    </div>
                </div>

                <div class="level-viz" style="animation-delay: 0.4s;">
                    <h3 style="font-size: 11px; letter-spacing: 3px; opacity: 0.5; margin-bottom: 10px;">NIVEL MICRO ¬∑
                        44 PREGUNTAS</h3>
                    <div class="micro-helix" id="microHelix">
                        <div class="helix-strand">
                        </div>
                    </div>
                </div>

                <div class="level-viz" style="animation-delay: 0.6s;">
                    <h3 style="font-size: 11px; letter-spacing: 3px; opacity: 0.5; margin-bottom: 10px;">RECOMENDACIONES
                        CR√çTICAS</h3>
                    <div id="recommendations">
                        <div class="rec-pill">
                            <span class="rec-priority">ALTA</span>
                            Fortalecer mecanismos de participaci√≥n ciudadana
                        </div>
                        <div class="rec-pill">
                            <span class="rec-priority">ALTA</span>
                            Implementar sistema de monitoreo continuo
                        </div>
                        <div class="rec-pill">
                            <span class="rec-priority">MEDIA</span>
                            Mejorar articulaci√≥n interinstitucional
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="evidence-stream">
            <div class="evidence-ticker" id="evidenceTicker">
                <div class="evidence-item"><span class="evidence-dot"></span>PDT Secci√≥n 3.2 ¬∑ P√°gina 45 ¬∑
                    "Implementaci√≥n de estrategias municipales"</div>
                <div class="evidence-item"><span class="evidence-dot"></span>PDT Cap√≠tulo 4 ¬∑ P√°gina 67 ¬∑ "Articulaci√≥n
                    con Dec√°logo DDHH"</div>
                <div class="evidence-item"><span class="evidence-dot"></span>Anexo T√©cnico ¬∑ P√°gina 112 ¬∑ "Indicadores
                    de cumplimiento territorial"</div>
                <div class="evidence-item"><span class="evidence-dot"></span>PDT Secci√≥n 5.1 ¬∑ P√°gina 89 ¬∑ "Proyecci√≥n
                    territorial 2030"</div>
                <div class="evidence-item"><span class="evidence-dot"></span>PATR Cap√≠tulo 2 ¬∑ P√°gina 34 ¬∑ "Cadenas de
                    valor agropecuarias"</div>
            </div>
        </div>
    </div>

    <div class="muni-overlay" id="muniOverlay">
        <div class="overlay-content">
            <div class="overlay-header">
                <h2 id="overlayTitle" style="font-size: 16px; letter-spacing: 2px;">AN√ÅLISIS MUNICIPAL</h2>
                <button class="close-overlay" onclick="closeMuniOverlay()">√ó</button>
            </div>
            <div class="overlay-body">
                <div class="viz-card">
                    <h4 style="font-size: 12px; margin-bottom: 20px; opacity: 0.7;">ALINEACI√ìN MACRO</h4>
                    <div class="radar-container">
                        <svg class="radar-web" viewBox="0 0 200 200">
                            <polygon class="radar-polygon" points="100,40 160,70 160,130 100,160 40,130 40,70" />
                            <polygon class="radar-polygon" points="100,60 140,80 140,120 100,140 60,120 60,80" />
                            <polygon class="radar-polygon" points="100,80 120,90 120,110 100,120 80,110 80,90" />
                            <polygon class="radar-data" points="100,50 150,75 145,125 100,150 55,120 50,75" />
                        </svg>
                    </div>
                </div>

                <div class="viz-card">
                    <h4 style="font-size: 12px; margin-bottom: 20px; opacity: 0.7;">AN√ÅLISIS POR CLUSTERS</h4>
                    <div id="clusterBars" style="height: 200px; position: relative;">
                    </div>
                </div>

                <div class="viz-card">
                    <h4 style="font-size: 12px; margin-bottom: 20px; opacity: 0.7;">DETALLE 44 PREGUNTAS</h4>
                    <div id="questionMatrix" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="control-interface">
        <button class="control-btn" onclick="toggleComparison()" title="Comparar">
            <span>‚äï</span>
        </button>
        <button class="control-btn" onclick="exportData()" title="Exportar">
            <span>‚Üì</span>
        </button>
        <button class="control-btn" onclick="toggleFilter()" title="Filtrar">
            <span>‚óà</span>
        </button>
        <button class="control-btn" onclick="toggleTimeline()" title="L√≠nea de Tiempo">
            <span>‚è±</span>
        </button>
        <button class="control-btn" onclick="toggleFocusMode()" title="Modo Enfoque">
            <span>üîç</span>
        </button>
    </div>

    <div class="comparison-matrix" id="comparisonMatrix">
        <h4 style="font-size: 11px; letter-spacing: 2px; margin-bottom: 10px;">MATRIZ COMPARATIVA</h4>
        <div class="matrix-grid" id="matrixGrid">
        </div>
    </div>

    <div class="timeline" id="timeline">
        <div class="timeline-scrubber" id="timelineScrubber"></div>
        <div class="timeline-years">
            <span>2018</span>
            <span>2020</span>
            <span>2022</span>
            <span>2024</span>
        </div>
    </div>

    <div class="radial-menu" id="radialMenu">
        <div class="radial-item" style="transform: translate(80px, 40px);" data-action="drillDown">üîç</div>
        <div class="radial-item" style="transform: translate(120px, 80px);" data-action="compare">‚áÑ</div>
        <div class="radial-item" style="transform: translate(100px, 130px);" data-action="analyze">üìä</div>
        <div class="radial-item" style="transform: translate(60px, 130px);" data-action="highlight">üåü</div>
        <div class="radial-item" style="transform: translate(40px, 80px);" data-action="export">üì•</div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div class="notification" id="notification">
        <div id="notificationMessage"></div>
    </div>

    <div class="loading-dna" id="loadingDNA">
        <div class="dna-strand">
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
            <div class="dna-bar"></div>
        </div>
    </div>

    <script>
        // PDET data embedded for standalone operation (no server needed)
        window.pdetRegions = [
            { id: 'arauca', name: 'Arauca', score: 85, x: 15, y: 20, municipalities: 7 },
            { id: 'catatumbo', name: 'Catatumbo', score: 72, x: 25, y: 15, municipalities: 8 },
            { id: 'montes_maria', name: 'Montes de Mar√≠a', score: 91, x: 35, y: 10, municipalities: 15 },
            { id: 'pacifico_medio', name: 'Pac√≠fico Medio', score: 64, x: 10, y: 40, municipalities: 4 },
            { id: 'putumayo', name: 'Putumayo', score: 78, x: 20, y: 80, municipalities: 9 },
            { id: 'sierra_nevada', name: 'Sierra Nevada', score: 88, x: 40, y: 5, municipalities: 8 },
            { id: 'uraba', name: 'Urab√° Antioque√±o', score: 69, x: 20, y: 25, municipalities: 8 },
            { id: 'choco', name: 'Choc√≥', score: 55, x: 8, y: 30, municipalities: 12 },
            { id: 'macarena', name: 'Macarena-Guaviare', score: 82, x: 45, y: 50, municipalities: 12 },
            { id: 'pacifico_narinense', name: 'Pac√≠fico Nari√±ense', score: 60, x: 5, y: 70, municipalities: 11 },
            { id: 'cuenca_caguan', name: 'Cuenca del Cagu√°n', score: 75, x: 30, y: 60, municipalities: 6 },
            { id: 'sur_tolima', name: 'Sur del Tolima', score: 89, x: 25, y: 45, municipalities: 4 },
            { id: 'sur_bolivar', name: 'Sur de Bol√≠var', score: 67, x: 30, y: 20, municipalities: 7 },
            { id: 'bajo_cauca', name: 'Bajo Cauca', score: 71, x: 28, y: 22, municipalities: 13 },
            { id: 'sur_cordoba', name: 'Sur de C√≥rdoba', score: 63, x: 22, y: 18, municipalities: 5 },
            { id: 'alto_patia', name: 'Alto Pat√≠a', score: 80, x: 15, y: 65, municipalities: 24 }
        ];

        const dashboardState = {
            currentView: 'constellation',
            focusMode: false,
            selectedRegions: [],
            timelineYear: 2024,
            dataVersion: 1
        };

        function initParticles() {
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 1,
                    speedX: Math.random() * 0.5 - 0.25,
                    speedY: Math.random() * 0.5 - 0.25,
                    color: `rgba(${Math.random() * 100 + 155}, ${Math.random() * 50 + 50}, ${Math.random() * 100 + 155}, ${Math.random() * 0.3 + 0.1})`
                });
            }

            let mouseX = null;
            let mouseY = null;

            canvas.addEventListener('mousemove', (event) => {
                mouseX = event.x;
                mouseY = event.y;

                if (Math.random() > 0.7) {
                    particles.push({
                        x: mouseX,
                        y: mouseY,
                        size: Math.random() * 3 + 1,
                        speedX: Math.random() * 2 - 1,
                        speedY: Math.random() * 2 - 1,
                        color: `rgba(0, 212, 255, ${Math.random() * 0.5 + 0.2})`
                    });
                }
            });

            canvas.addEventListener('mouseleave', () => {
                mouseX = null;
                mouseY = null;
            });

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < particles.length; i++) {
                    let p = particles[i];

                    p.x += p.speedX;
                    p.y += p.speedY;

                    if (mouseX !== null && mouseY !== null) {
                        let dx = mouseX - p.x;
                        let dy = mouseY - p.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < 100) {
                            p.x += dx * 0.02;
                            p.y += dy * 0.02;
                        }
                    }

                    if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();

                    for (let j = i; j < particles.length; j++) {
                        let p2 = particles[j];
                        let dx = p.x - p2.x;
                        let dy = p.y - p2.y;
                        let distance = Math.sqrt(dx * dx + dy * dy);

                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(0, 212, 255, ${0.1 * (1 - distance / 100)})`;
                            ctx.lineWidth = 0.5;
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                }

                if (particles.length > 150) {
                    particles = particles.filter(p => p.size > 0.5);
                }

                requestAnimationFrame(animate);
            }

            animate();
        }

        function initConstellation() {
            const container = document.getElementById('pdetNodes');
            const canvas = document.getElementById('neuralCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = container.parentElement.offsetWidth;
            canvas.height = container.parentElement.offsetHeight;

            drawNeuralConnections(ctx, canvas.width, canvas.height);

            pdetRegions.forEach((region, index) => {
                const node = createPDETNode(region, canvas.width, canvas.height);
                container.appendChild(node);

                setTimeout(() => {
                    node.style.opacity = '1';
                    node.style.transform = 'scale(1)';
                }, index * 100);
            });
        }

        function createPDETNode(region, containerWidth, containerHeight) {
            const node = document.createElement('div');
            node.className = 'pdet-node';
            node.style.left = `${region.x}%`;
            node.style.top = `${region.y}%`;
            node.style.opacity = '0';
            node.style.transform = 'scale(0)';
            node.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
            node.setAttribute('data-region-id', region.id);

            const scoreColor = region.score > 70 ? 'var(--atroz-green-toxic)' :
                region.score > 60 ? 'var(--atroz-copper-oxide)' : 'var(--atroz-red-500)';

            node.innerHTML = `
                <div class="pdet-core">
                    <div class="pdet-hexagon"></div>
                    <div class="pdet-pulse"></div>
                    <div class="pdet-inner">
                        <div class="pdet-score" style="color: ${scoreColor}">${region.score}</div>
                        <div class="pdet-name">${region.name}</div>
                    </div>
                </div>
            `;

            node.addEventListener('click', () => openMunicipalityDetail(region));

            node.addEventListener('mousemove', (e) => {
                showTooltip(e, `${region.name}: ${region.score}% de alineaci√≥n`);
            });

            node.addEventListener('mouseleave', () => {
                hideTooltip();
            });

            node.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                toggleRegionSelection(region.id);
                showRadialMenu(e);
            });

            return node;
        }

        function drawNeuralConnections(ctx, width, height) {
            ctx.strokeStyle = 'rgba(0, 212, 255, 0.1)';
            ctx.lineWidth = 0.5;

            pdetRegions.forEach((region1, i) => {
                pdetRegions.forEach((region2, j) => {
                    if (i < j && Math.random() > 0.7) {
                        ctx.beginPath();
                        ctx.moveTo(region1.x * width / 100, region1.y * height / 100);
                        ctx.lineTo(region2.x * width / 100, region2.y * height / 100);
                        ctx.stroke();
                    }
                });
            });

            animateNeuralFlow(ctx, width, height);
        }

        function animateNeuralFlow(ctx, width, height) {
            let particles = [];

            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2
                });
            }

            function animate() {
                ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
                ctx.fillRect(0, 0, width, height);

                ctx.fillStyle = 'rgba(0, 212, 255, 0.5)';
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > width) p.vx *= -1;
                    if (p.y < 0 || p.y > height) p.vy *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                requestAnimationFrame(animate);
            }

            animate();
        }

        function createDNAHelix() {
            const helix = document.querySelector('.helix-strand');
            const numPoints = 44;

            for (let i = 0; i < numPoints; i++) {
                const angle = (i / numPoints) * Math.PI * 4;
                const y = (i / numPoints) * 100;
                const x1 = 50 + Math.cos(angle) * 40;
                const x2 = 50 - Math.cos(angle) * 40;

                const point1 = document.createElement('div');
                point1.className = 'helix-point';
                point1.style.left = `${x1}%`;
                point1.style.top = `${y}%`;
                helix.appendChild(point1);

                const point2 = document.createElement('div');
                point2.className = 'helix-point';
                point2.style.left = `${x2}%`;
                point2.style.top = `${y}%`;
                helix.appendChild(point2);

                if (i % 3 === 0) {
                    const connector = document.createElement('div');
                    connector.className = 'helix-connector';
                    connector.style.top = `${y}%`;
                    helix.appendChild(connector);
                }

                if (i % 5 === 0) {
                    const card = document.createElement('div');
                    card.className = 'question-card';
                    card.style.left = `${x1 + 5}%`;
                    card.style.top = `${y}%`;
                    card.innerHTML = `Q${i + 1} <span class="q-score">${Math.floor(Math.random() * 40) + 60}</span>`;
                    card.addEventListener('click', () => {
                        highlightElement(card);
                    });
                    helix.appendChild(card);
                }
            }
        }

        function openMunicipalityDetail(region) {
            const overlay = document.getElementById('muniOverlay');
            const title = document.getElementById('overlayTitle');

            title.textContent = `${region.name} ¬∑ ${region.municipalities} MUNICIPIOS`;

            const matrix = document.getElementById('questionMatrix');
            matrix.innerHTML = '';
            for (let i = 1; i <= 44; i++) {
                const cell = document.createElement('div');
                const score = Math.random();
                const color = score > 0.7 ? 'var(--atroz-green-toxic)' :
                    score > 0.4 ? 'var(--atroz-copper-oxide)' : 'var(--atroz-red-500)';

                cell.style.cssText = `
                    width: 100%;
                    aspect-ratio: 1;
                    background: ${color};
                    opacity: ${score};
                    cursor: pointer;
                    transition: all 0.2s;
                `;

                cell.addEventListener('mouseenter', () => {
                    cell.style.transform = 'scale(1.5)';
                    cell.style.zIndex = '10';
                    showTooltip({ clientX: event.clientX, clientY: event.clientY }, `Pregunta ${i}: ${Math.round(score * 100)}%`);
                });

                cell.addEventListener('mouseleave', () => {
                    cell.style.transform = 'scale(1)';
                    cell.style.zIndex = '1';
                    hideTooltip();
                });

                matrix.appendChild(cell);
            }

            const clusters = ['GOBERNANZA', 'SOCIAL', 'ECON√ìMICO', 'AMBIENTAL'];
            const clusterBars = document.getElementById('clusterBars');
            clusterBars.innerHTML = '';

            clusters.forEach((cluster, i) => {
                const value = Math.floor(Math.random() * 40) + 60;
                const bar = document.createElement('div');
                bar.style.cssText = `
                    position: absolute;
                    bottom: 0;
                    left: ${i * 25}%;
                    width: 20%;
                    height: ${value}%;
                    background: linear-gradient(180deg, var(--atroz-blue-electric), transparent);
                    border: 1px solid var(--atroz-blue-electric);
                    transition: all 0.3s;
                `;

                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    bottom: -20px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 8px;
                    white-space: nowrap;
                `;
                label.textContent = cluster;

                bar.appendChild(label);
                clusterBars.appendChild(bar);
            });

            overlay.classList.add('active');
        }

        function closeMuniOverlay() {
            document.getElementById('muniOverlay').classList.remove('active');
        }

        function toggleComparison() {
            const matrix = document.getElementById('comparisonMatrix');
            matrix.classList.toggle('active');

            if (matrix.classList.contains('active')) {
                const grid = document.getElementById('matrixGrid');
                grid.innerHTML = '';

                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.textContent = Math.floor(Math.random() * 100);
                    grid.appendChild(cell);
                }
            }
        }

        function toggleTimeline() {
            const timeline = document.getElementById('timeline');
            timeline.classList.toggle('active');
        }

        function toggleFocusMode() {
            dashboardState.focusMode = !dashboardState.focusMode;
            document.body.classList.toggle('focus-mode');

            showNotification(dashboardState.focusMode ?
                'Modo enfoque activado' : 'Modo enfoque desactivado');
        }

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.left = `${event.clientX + 10}px`;
            tooltip.style.top = `${event.clientY + 10}px`;
            tooltip.classList.add('active');
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('active');
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            const messageEl = document.getElementById('notificationMessage');

            messageEl.textContent = message;
            notification.classList.add('active');

            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        function highlightElement(element) {
            document.querySelectorAll('.focused').forEach(el => {
                el.classList.remove('focused');
            });

            element.classList.add('focused');

            document.body.classList.add('focus-mode');
            dashboardState.focusMode = true;
        }

        function toggleRegionSelection(regionId) {
            const index = dashboardState.selectedRegions.indexOf(regionId);

            if (index === -1) {
                dashboardState.selectedRegions.push(regionId);
                document.querySelector(`[data-region-id="${regionId}"]`).classList.add('focused');
            } else {
                dashboardState.selectedRegions.splice(index, 1);
                document.querySelector(`[data-region-id="${regionId}"]`).classList.remove('focused');
            }

            showNotification(`${dashboardState.selectedRegions.length} regiones seleccionadas`);
        }

        function showRadialMenu(event) {
            const radialMenu = document.getElementById('radialMenu');
            radialMenu.style.left = `${event.clientX - 100}px`;
            radialMenu.style.top = `${event.clientY - 100}px`;
            radialMenu.classList.add('active');

            setTimeout(() => {
                document.addEventListener('click', closeRadialMenu);
            }, 10);
        }

        function closeRadialMenu() {
            const radialMenu = document.getElementById('radialMenu');
            radialMenu.classList.remove('active');
            document.removeEventListener('click', closeRadialMenu);
        }

        document.querySelectorAll('.nav-pill').forEach(pill => {
            pill.addEventListener('click', (e) => {
                document.querySelectorAll('.nav-pill').forEach(p => p.classList.remove('active'));
                e.currentTarget.classList.add('active');

                const view = e.currentTarget.dataset.view;
                dashboardState.currentView = view;

                const loading = document.getElementById('loadingDNA');
                loading.classList.add('active');

                setTimeout(() => {
                    loading.classList.remove('active');
                }, 1000);
            });
        });

        window.addEventListener('DOMContentLoaded', () => {
            initParticles();
            initConstellation();
            createDNAHelix();

            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showRadialMenu(e);
            });

            document.querySelectorAll('.radial-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const action = e.currentTarget.dataset.action;
                    handleRadialAction(action);
                    closeRadialMenu();
                });
            });
        });

        function handleRadialAction(action) {
            switch (action) {
                case 'drillDown':
                    if (dashboardState.selectedRegions.length > 0) {
                        showNotification(`Analizando ${dashboardState.selectedRegions.length} regiones`);
                    } else {
                        showNotification('Seleccione al menos una regi√≥n primero');
                    }
                    break;
                case 'compare':
                    toggleComparison();
                    break;
                case 'analyze':
                    showNotification('Iniciando an√°lisis profundo...');
                    break;
                case 'highlight':
                    toggleFocusMode();
                    break;
                case 'export':
                    exportData();
                    break;
            }
        }

        function exportData() {
            const loading = document.getElementById('loadingDNA');
            loading.classList.add('active');

            setTimeout(() => {
                loading.classList.remove('active');
                showNotification('Datos exportados con √©xito');
            }, 1500);
        }

        function toggleFilter() {
            showNotification('Filtros aplicados');
        }

        // --- LIVE BACKEND INTEGRATION (optional - works without server) ---
        let socket = null;
        let adminActive = false;

        try {
            if (typeof io !== 'undefined') {
                socket = io('http://localhost:5000');
            }
        } catch (e) {
            console.log('Server not available, running in standalone mode');
        }

        // Socket Events (only if server is available)
        if (socket) {
            socket.on('connect', () => {
                logAdmin('Conectado al servidor visceral [OK]', 'success');
                showNotification('SISTEMA ONLINE');
            });

            socket.on('disconnect', () => {
                logAdmin('Desconectado del servidor [ERR]', 'error');
                showNotification('CONEXI√ìN PERDIDA');
            });

            socket.on('job_created', (data) => {
                logAdmin(`Nuevo trabajo iniciado: ${data.filename} [${data.job_id}]`, 'info');
                addJobToQueue(data);
            });

            socket.on('pipeline_progress', (data) => {
                updateJobProgress(data);
                if (adminActive) updateMetrics();
            });

            socket.on('pipeline_completed', (data) => {
                logAdmin(`An√°lisis completado: ${data.job_id}`, 'success');
                showNotification('AN√ÅLISIS FINALIZADO');
                loadPDETData();
            });
        } // End of if(socket)

        // Admin Layer Logic (works without server)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                toggleAdmin();
            }
        });

        function toggleAdmin() {
            const layer = document.getElementById('adminLayer');
            adminActive = !adminActive;

            if (adminActive) {
                layer.classList.add('active');
                updateMetrics();
            } else {
                layer.classList.remove('active');
            }
        }

        function closeAdmin() {
            adminActive = false;
            document.getElementById('adminLayer').classList.remove('active');
        }

        function switchAdminPanel(panelId) {
            document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.admin-nav-item').forEach(i => i.classList.remove('active'));

            document.getElementById(`panel-${panelId}`).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function logAdmin(msg, type = 'info') {
            const logs = document.getElementById('liveLogs');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        // File Upload Logic
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--atroz-green-toxic)';
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--atroz-copper-500)';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--atroz-copper-500)';
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type === 'application/pdf') {
                    uploadFile(file);
                } else {
                    logAdmin(`Archivo ignorado: ${file.name} (No es PDF)`, 'error');
                }
            });
        }

        function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            logAdmin(`Subiendo: ${file.name}...`, 'info');

            fetch('http://localhost:5000/api/upload/plan', {
                method: 'POST',
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        logAdmin(`Error subida: ${data.error}`, 'error');
                    } else {
                        logAdmin(`Subida exitosa: ${file.name}`, 'success');
                    }
                })
                .catch(err => logAdmin(`Error red: ${err}`, 'error'));
        }

        function addJobToQueue(data) {
            const queue = document.getElementById('uploadQueue');
            const item = document.createElement('div');
            item.id = `job-${data.job_id}`;
            item.style.cssText = `
                background: rgba(0,0,0,0.5);
                border: 1px solid var(--atroz-blue-700);
                padding: 10px;
                margin-bottom: 5px;
                font-size: 11px;
            `;
            item.innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <span>${data.filename}</span>
                    <span class="status">EN COLA</span>
                </div>
                <div style="width:100%; height:2px; background:#333; margin-top:5px;">
                    <div class="progress-bar" style="width:0%; height:100%; background:var(--atroz-blue-electric); transition:width 0.3s;"></div>
                </div>
            `;
            queue.prepend(item);
        }

        function updateJobProgress(data) {
            const item = document.getElementById(`job-${data.job_id}`);
            if (item) {
                item.querySelector('.progress-bar').style.width = `${data.progress}%`;
                item.querySelector('.status').textContent = `${data.phase_name} (${data.progress}%)`;

                if (data.progress === 100) {
                    item.querySelector('.status').textContent = 'COMPLETADO';
                    item.querySelector('.status').style.color = 'var(--atroz-green-toxic)';
                }
            }
        }

        function updateMetrics() {
            fetch('http://localhost:5000/api/metrics')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('metric-cpu').textContent = `${data.cpu}%`;
                    document.getElementById('metric-mem').textContent = `${data.memory}%`;
                    document.getElementById('metric-jobs').textContent = data.active_jobs;
                    document.getElementById('metric-uptime').textContent = `${Math.floor(data.uptime)}s`;
                });
        }

        // Load Live Data
        async function loadPDETData() {
            try {
                const res = await fetch('http://localhost:5000/api/pdet-regions');
                const data = await res.json();
                window.pdetRegions = data;

                // Redraw constellation with new data
                const container = document.getElementById('pdetNodes');
                if (container) {
                    container.innerHTML = '';
                    initConstellation();
                }
            } catch (err) {
                console.error('Error loading PDET data:', err);
                logAdmin('Error cargando datos PDET', 'error');
            }
        }

        // Load Evidence Stream
        async function loadEvidence() {
            try {
                const res = await fetch('http://localhost:5000/api/evidence');
                const data = await res.json();
                renderEvidence(data);
            } catch (err) {
                console.error('Error loading evidence:', err);
            }
        }

        function renderEvidence(items) {
            const ticker = document.getElementById('evidenceTicker');
            if (!ticker) return;

            ticker.innerHTML = items.map(item => `
                <div class="evidence-item">
                    <span class="evidence-dot"></span>
                    ${item.source} ¬∑ P√°gina ${item.page} ¬∑ "${item.text}"
                </div>
            `).join('');
        }

        // WebSocket event for new evidence
        socket.on('new_evidence', (data) => {
            const ticker = document.getElementById('evidenceTicker');
            if (ticker) {
                const item = document.createElement('div');
                item.className = 'evidence-item';
                item.innerHTML = `<span class="evidence-dot"></span> ${data.source} ¬∑ P√°gina ${data.page} ¬∑ "${data.text}"`;
                ticker.prepend(item);
            }
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadPDETData();
            loadEvidence();
        });
    </script>
    <!-- ADMIN LAYER -->
    <div class="admin-layer" id="adminLayer">
        <div class="admin-container">
            <div class="admin-sidebar">
                <div class="admin-header">SISTEMA VISCERAL /// ADMIN</div>
                <div class="admin-nav-item active" onclick="switchAdminPanel('logs')">LOGS EN VIVO</div>
                <div class="admin-nav-item" onclick="switchAdminPanel('upload')">CARGA DE PLANES</div>
                <div class="admin-nav-item" onclick="switchAdminPanel('metrics')">M√âTRICAS DEL SISTEMA</div>
                <div class="admin-nav-item" onclick="switchAdminPanel('pipeline')">PIPELINE MONITOR</div>
                <div class="admin-nav-item" onclick="closeAdmin()">[ESC] CERRAR</div>
            </div>

            <div class="admin-content">
                <!-- LOGS PANEL -->
                <div class="admin-panel active" id="panel-logs">
                    <div class="terminal-window" id="liveLogs">
                        <div class="log-entry info">[SYSTEM] Conectado al n√∫cleo visceral...</div>
                        <div class="log-entry info">[SYSTEM] Esperando flujo de datos...</div>
                    </div>
                </div>

                <!-- UPLOAD PANEL -->
                <div class="admin-panel" id="panel-upload">
                    <div class="upload-zone" id="dropZone">
                        <div style="font-size: 40px; margin-bottom: 20px;">‚ö°</div>
                        <div>ARRASTRE PLANES DE DESARROLLO AQU√ç</div>
                        <div style="font-size: 10px; opacity: 0.6; margin-top: 10px;">PDF FORMAT ONLY ¬∑ BATCH SUPPORTED
                        </div>
                        <input type="file" id="fileInput" multiple style="display: none" accept=".pdf">
                    </div>
                    <div id="uploadQueue" style="margin-top: 20px;"></div>
                </div>

                <!-- METRICS PANEL -->
                <div class="admin-panel" id="panel-metrics">
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="metric-cpu">0%</div>
                            <div class="metric-label">CPU LOAD</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="metric-mem">0%</div>
                            <div class="metric-label">MEMORY USAGE</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="metric-jobs">0</div>
                            <div class="metric-label">ACTIVE JOBS</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="metric-uptime">0s</div>
                            <div class="metric-label">UPTIME</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>