# =============================================================================
# CONFIGURACIÓN DE CALIBRACIÓN PARA CausalExtractor
# Sistema de Evaluación Causal FARFAN 3.1 - CDAF
# =============================================================================
# Propósito: Identificar y estructurar la cadena causal completa en PDM de Colombia
# Eslabones: Insumos → Actividades → Productos → Resultados → Impactos → Causalidad
# Autor original: JCRR | Mant. técnico: Equipo CDAF
# Fecha: 2025-11-03
# Versión: 2.1.0
# =============================================================================

causal_extractor:
  version: "2.1.0"
  locale: "es-CO"
  description: "Calibración semántica y operativa para extracción causal en PDM (Colombia)."
  case_insensitive: true
  unicode_normalization: "NFC"
  default_context_window: 50   # palabras a la izquierda y derecha
  max_context_window: 120
  tokenizer: "spacy_es_core_news_md"
  sentence_splitter: "rule+ml"  # reglas y modelo
  number_normalizer: "spanish_cardinal_ordinal"
  money_normalizer: "COP_parser"  # reconoce $ 1.234,56; COP 1.234; millones; miles de millones

  # ===========================================================================
  # SECCIÓN 0: PREPROCESAMIENTO Y NORMALIZACIÓN
  # ===========================================================================
  preprocessing:
    lower: true
    strip_accents: false
    collapse_whitespace: true
    replace_nbsp: true
    unify_quotes: true
    normalize_percentages: true
    normalize_dates: true
    expand_abbrev:
      - {pattern: "\\bSGP\\b", replace: "Sistema General de Participaciones"}
      - {pattern: "\\bBPIN\\b", replace: "Banco de Programas y Proyectos de Inversión Nacional"}
      - {pattern: "\\bPOAI\\b", replace: "Plan Operativo Anual de Inversiones"}
      - {pattern: "\\bPOT\\b", replace: "Plan de Ordenamiento Territorial"}
      - {pattern: "\\bPDD\\b", replace: "Plan de Desarrollo Departamental"}
      - {pattern: "\\bPDM\\b", replace: "Plan de Desarrollo Municipal"}
      - {pattern: "\\bSISBEN\\b", replace: "Sistema de Identificación de Potenciales Beneficiarios"}
      - {pattern: "\\bGEIH\\b", replace: "Gran Encuesta Integrada de Hogares"}

  # ===========================================================================
  # SECCIÓN 1: ESLABONES DE LA CADENA CAUSAL
  # ===========================================================================
  eslabones:

    # -------------------------------------------------------------------------
    # ESLABÓN 1: INSUMOS (Diagnóstico y Líneas Base)
    # -------------------------------------------------------------------------
    Insumos:
      description: >
        Elementos de diagnóstico, línea base cuantitativa, brechas, fuentes oficiales,
        población objetivo y dotación presupuestal disponible para iniciar la intervención.
      negative_lookbehind:
        - "(?:proyectada|meta|objetivo|esperada)\\s+como\\s+línea\\s*base"   # evita metas confundidas con línea base
      regex_list:
        - "línea\\s*de?\\s*base"
        - "situación\\s*(?:/|\\s*)?actual"
        - "diagnóstico\\s*(?:territorial|municipal|departamental|local)"
        - "caracterización\\s*(?:territorial|poblacional|socioeconómica)"
        - "análisis\\s*de\\s*situación|contexto\\s*territorial"
        - "problemática\\s*identificada|identificación\\s*de\\s*(?:brechas|necesidades|problemas)"
        - "indicador(?:es)?\\s*(?:base|inicial(?:es)?)|valor\\s*(?:inicial|de\\s*referencia|base)"
        - "dato(?:s)?\\s*(?:estadístico(?:s)?|cuantitativo(?:s)?)|cifra(?:s)?\\s*(?:oficial(?:es)?)"
        - "tasa\\s*(?:de|por)\\s*\\d{1,3}(?:[\\s,.]?)?(?:000|mil|100\\.?000)"
        - "\\d{1,3}(?:[.,]\\d{1,3})?\\s*%"
        - "(?:año|vigencia|período)\\s*(?:19\\d{2}|20\\d{2})"
        - "fuente:\\s*(?:DANE|Ministerio|Secretar[ií]a|Observatorio|SISPRO|SIMAT|SUI|UARIV|ICBF|INPEC|UNODC|Medicina\\s*Legal|Polic[ií]a\\s*Nacional|Fiscal[ií]a|Migración\\s*Colombia)"
        - "según\\s*(?:el\\s*)?(?:DANE|Censo|Encuesta|Registro|GEIH)"
        - "(?:presupuesto|apropiaci[oó]n|dotaci[oó]n)\\s*(?:asignad[ao]|disponible|inicial|total)"
        - "recursos\\s*(?:financieros|econ[oó]micos|propios|de\\s*cofinanciaci[oó]n|regal[ií]as|SGP)"
        - "\\$\\s*[\\d\\.,]+\\s*(?:millones|miles\\s*de\\s*millones)?|(?:COP|pesos)\\s*[\\d\\.,]+"
        - "BPIN\\s*\\d+|c[oó]digo\\s*BPIN|Plan\\s*Plurianual\\s*de\\s*Inversiones|POAI"
        - "poblaci[oó]n\\s*(?:objetivo|afectada|total|diagnosticada)|beneficiari[oa]s\\s*(?:potenciales|identificados?)"
        - "\\b(?:habitantes|personas|familias|hogares)\\b"
        - "(?:zona|área|territorio)\\s*(?:urbana|rural|priorizada|focalizada|de\\s*influencia)"
        - "brecha(?:s)?|d[eé]ficit|necesidad(?:es)?\\s*insatisfecha(?:s)?|carencia(?:s)?|barrera(?:s)?\\s*de\\s*acceso|situaci[oó]n\\s*cr[ií]tica"

    # -------------------------------------------------------------------------
    # ESLABÓN 2: ACTIVIDADES (Diseño de Intervención)
    # -------------------------------------------------------------------------
    Actividades:
      description: >
        Acciones, tareas y procesos programados con responsables, cronograma,
        modalidad y recursos asignados para ejecutar la intervención.
      guardrails:
        - "si contiene 'meta(s)' y unidad de medida → evaluar primero Productos"
      regex_list:
        - "(?:realizar|ejecutar|implementar|desarrollar|llevar\\s*a\\s*cabo)\\b"
        - "(?:formular|elaborar|diseñar|construir|crear|dotar|adquirir|instalar)"
        - "(?:capacitar|formar|entrenar|sensibilizar|socializar|comunicar)"
        - "(?:articular|coordinar|integrar|vincular|fortalecer|optimizar)"
        - "(?:monitorear|supervisar|hacer\\s*seguimiento|evaluar|diagnosticar)"
        - "(?:taller(?:es)?|jornada(?:s)?|encuentro(?:s)?|sesiones?)\\s+(?:de|para)"
        - "(?:campaña|estrategia)\\s+de\\s+(?:sensibilizaci[oó]n|promoci[oó]n|prevenci[oó]n)"
        - "(?:asistencia\\s*t[eé]cnica|acompañamiento|asesor[ií]a)\\s+(?:a|para)"
        - "(?:construcci[oó]n|adecuaci[oó]n|mejoramiento)\\s+de\\s+(?:infraestructura|espacios)"
        - "(?:implementaci[oó]n|operaci[oó]n)\\s+de\\s+(?:sistema|modelo|estrategia|plataforma)"
        - "caracterizaci[oó]n|identificaci[oó]n|registro|censo"
        - "responsable:\\s*(?:Secretar[ií]a|Alcald[ií]a|Entidad|Direcci[oó]n)|a\\s*cargo\\s*de"
        - "cronograma\\s+de\\s+(?:actividades|implementaci[oó]n|ejecuci[oó]n)"
        - "durante\\s+(?:el\\s+)?(?:año|cuatrienio|vigencia)|en\\s+el\\s+(?:primer|segundo|tercer|cuarto)\\s*(?:año|semestre|trimestre)"
        - "modalidad\\s+(?:presencial|virtual|h[ií]brida|comunitaria)"
        - "costo\\s+(?:unitario|total)|valor\\s+estimado|recursos\\s+(?:requeridos|necesarios)"

    # -------------------------------------------------------------------------
    # ESLABÓN 3: PRODUCTOS (Verificables)
    # -------------------------------------------------------------------------
    Productos:
      description: >
        Bienes o servicios entregados por las actividades, con metas, unidades de medida
        e indicadores verificables mediante evidencia documental.
      unit_keywords: ["número","porcentaje","tasa","índice","unidades","hectáreas","kilómetros","metros","sedes","equipos","kits"]
      regex_list:
        - "producto(?:s)?\\s+(?:entregado(?:s)?|generado(?:s)?|obtenido(?:s)?)|entregable(?:s)?"
        - "servicio(?:s)?\\s+(?:prestado(?:s)?|brindado(?:s)?|ofrecido(?:s)?)|obra(?:s)?\\s+(?:ejecutada(?:s)?|entregada(?:s)?)|infraestructura\\s+(?:construida|adecuada|mejorada|entregada)"
        - "meta(?:s)?\\s+(?:de\\s+producto|cuantitativa(?:s)?|f[ií]sica(?:s)?|anual(?:es)?|del\\s+cuatrienio)"
        - "indicador(?:es)?\\s+de\\s+producto|unidad(?:es)?\\s+de\\s+medida|f[oó]rmula"
        - "\\b\\d{1,3}(?:[\\.,]\\d{3})*(?:,\\d+)?\\s+(?:personas|familias|niñ[oa]s|j[oó]venes|mujeres|docentes|funcionarios|l[ií]deres|agentes)\\s+(?:atendid[oa]s|beneficiad[oa]s|capacitad[oa]s|formad[oa]s|certificados?)"
        - "\\b\\d{1,3}(?:[\\.,]\\d{3})*(?:,\\d+)?\\s+(?:taller(?:es)?|jornada(?:s)?|campañas|documentos|estudios|diagn[oó]sticos|protocolos|lineamientos|modelos|espacios|sedes|equipos|kits|insumos|hect[aá]reas|kil[oó]metros|metros|convenios|mesas|redes|programas|proyectos|sistemas|plataformas|aplicaciones|rutas)\\b"
        - "medio(?:s)?\\s+de\\s+verificaci[oó]n|fuente(?:s)?\\s+de\\s+verificaci[oó]n|actas?|listados?|certificados?|informes?\\s+(?:de\\s+)?(?:ejecuci[oó]n|avance|supervisi[oó]n)|facturas?|contratos?|registro\\s+fotogr[aá]fico|evidencia(?:s)?\\s+documental(?:es)?"
        - "cobertura\\s+(?:municipal|urbana|rural|total)|focalizaci[oó]n\\s+en\\s+(?:zona(?:s)?|poblaci[oó]n)|alcance\\s+(?:geogr[aá]fico|poblacional)"
        - "\\b\\d{1,3}(?:[\\.,]\\d{3})*(?:,\\d+)?\\s*%\\b"

    # -------------------------------------------------------------------------
    # ESLABÓN 4: RESULTADOS (Medibles)
    # -------------------------------------------------------------------------
    Resultados:
      description: >
        Cambios en condiciones, comportamientos o indicadores de la población objetivo
        atribuibles a los productos, usualmente en el corto o mediano plazo.
      disambiguation_rules:
        - "si contiene 'cambio/mejora/reducción' + indicador → Resultado"
        - "si solo hay conteos de entregas → Producto"
      regex_list:
        - "resultado(?:s)?\\s+(?:esperado(?:s)?|objetivo(?:s)?|alcanzado(?:s)?)|efecto(?:s)?\\s+(?:directo(?:s)?|esperado(?:s)?)|transformaci[oó]n(?:es)?"
        - "mejora(?:s)?\\s+(?:en\\s+(?:la|las|los)|de)|cambio(?:s)?\\s+(?:en|esperado(?:s)?)|logro(?:s)?"
        - "indicador(?:es)?\\s+de\\s+resultado|meta(?:s)?\\s+de\\s+resultado|indicador(?:es)?\\s+de\\s+efecto"
        - "(?:incremento|aumento|mejora)\\s+(?:en\\s+(?:el|la)\\s+)?(?:acceso|cobertura|calidad)"
        - "(?:reducci[oó]n|disminuci[oó]n|descenso)\\s+de\\s+(?:tasa|brecha|d[eé]ficit|casos|eventos)"
        - "tasa|porcentaje|[ií]ndice\\s+de\\s+[\\w\\s]+\\s+(?:se\\s+reduce|disminuye|desciende|aumenta|mejora|se\\s+incrementa)"
        - "brecha(?:s)?\\s+(?:reducida(?:s)?|cerrada(?:s)?);\\s*d[eé]ficit\\s+(?:reducido|disminuido)"
        - "poblaci[oó]n|comunidad(?:es)?\\s+(?:con\\s+acceso|empoderada(?:s)?|con\\s+capacidad|con\\s+mejores\\s+condiciones)"
        - "prevenci[oó]n\\s+(?:efectiva|de)\\b|mitigaci[oó]n\\s+de\\s+(?:riesgos|impactos)"

    # -------------------------------------------------------------------------
    # ESLABÓN 5: IMPACTOS (Transformación)
    # -------------------------------------------------------------------------
    Impactos:
      description: >
        Efectos finales y de largo plazo, transformaciones estructurales y sostenibles
        del desarrollo territorial; contribuciones a ODS e índices de desarrollo.
      regex_list:
        - "impacto(?:s)?\\s+(?:final(?:es)?|esperado(?:s)?|de\\s+largo\\s+plazo)"
        - "efecto(?:s)?\\s+(?:estructural(?:es)?|sostenible(?:s)?|de\\s+largo\\s+plazo)|transformaci[oó]n(?:es)?\\s+(?:estructural(?:es)?|sostenible(?:s)?|territorial(?:es)?)"
        - "indicador(?:es)?\\s+de\\s+impacto|meta(?:s)?\\s+de\\s+impacto|resultado\\s+final"
        - "desarrollo\\s+(?:territorial|sostenible|integral|humano)|calidad\\s+de\\s+vida|bienestar|prosperidad|buen\\s+vivir"
        - "(?:IPM|[ií]ndice\\s+de\\s+pobreza\\s+multidimensional)\\s+(?:reducido|menor)|(?:IDH|[ií]ndice\\s+de\\s+desarrollo\\s+humano)\\s+(?:mejorado|incrementado)|NBI\\s+(?:reducidas|menores)|GINI\\s+(?:reducido|menor)"
        - "esperanza\\s+de\\s+vida\\s+(?:mayor|incrementada)|ingreso\\s+per\\s+c[aá]pita\\s+(?:mayor|incrementado)"
        - "contribuci[oó]n\\s+a(?:l)?\\s+ODS|ODS\\s+\\d+|Agenda\\s+2030|metas?\\s+de\\s+ODS"
        - "paz\\s+territorial|convivencia\\s+pacífica|reconciliaci[oó]n|no\\s+repetici[oó]n"
        - "equidad\\s+(?:de\\s+g[eé]nero|territorial|social)|igualdad\\s+de\\s+(?:oportunidades|derechos)|inclusi[oó]n\\s+social|cierre\\s+de\\s+brechas\\s+(?:estructurales|hist[oó]ricas)"
        - "sostenibilidad\\s+(?:ambiental|econ[oó]mica|social|territorial)|resiliencia\\s+(?:territorial|comunitaria|clim[aá]tica)"
        - "competitividad\\s+territorial|productividad\\s+(?:incrementada|mejorada)|crecimiento\\s+econ[oó]mico\\s+(?:sostenible|inclusivo)"
        - "fortalecimiento\\s+institucional\\s+(?:permanente|sostenido)|gobernabilidad|gobernanza|confianza\\s+institucional|capacidad\\s+instalada"

    # -------------------------------------------------------------------------
    # ESLABÓN 6: CAUSALIDAD (Enlaces y Mecanismos)
    # -------------------------------------------------------------------------
    Causalidad:
      description: >
        Conectores causales, mecanismos de cambio y teoría de cambio que explican
        cómo y por qué los eslabones se vinculan. Incluye condicionales si-entonces.
      coreference_pronouns: ["esto","ello","lo anterior","dicho","tal","aquello"]
      regex_list:
        - "conduce\\s*a|resulta\\s*(?:en|de)|genera(?:ndo)?|produce(?:ndo)?|ocasiona(?:ndo)?|provoca(?:ndo)?|causa(?:ndo)?|deriva\\s*en|desemboca\\s*en|conlleva\\s*a|trae\\s*como\\s*consecuencia|tiene\\s*como\\s*efecto|implica|se\\s*traduce\\s*en|contribuye\\s*a|aporta\\s*a|facilita|posibilita|habilita|viabiliza"
        - "con\\s*el\\s*(?:fin|prop[oó]sito|objetivo)\\s*de|a\\s*fin\\s*de|para\\s*(?:lograr|alcanzar|conseguir|obtener)|de\\s*(?:tal|modo)\\s*que|con\\s*miras\\s*a|orientado\\s*a|dirigido\\s*a|destinado\\s*a|enfocado\\s*(?:en|a)"
        - "lo\\s*(?:cual|que|anterior|dicho)\\s*permite|esto\\s*permite|de\\s*esta\\s*(?:forma|manera)|as[ií]\\s*se\\s*(?:logra|consigue)|en\\s*consecuencia|como\\s*consecuencia|por\\s*(?:consiguiente|lo\\s*tanto|ende)|de\\s*ah[ií]\\s*que"
        - "debido\\s*a|gracias\\s*a|a\\s*trav[eé]s\\s*de|mediante|por\\s*medio\\s*de|a\\s*partir\\s*de|como\\s*resultado\\s*de|producto\\s*de|derivado\\s*de|en\\s*virtud\\s*de"
        - "teor[ií]a\\s*de\\s*cambio|l[oó]gica\\s*de\\s*intervenci[oó]n|cadena\\s*de\\s*valor|marco\\s*l[oó]gico|ruta\\s*causal|mecanismo(?:s)?\\s*de\\s*cambio|supuesto(?:s)?\\s*causal(?:es)?|v[ií]nculo\\s*causal|relaci[oó]n\\s*cau(?:sa)?-efecto"
        - "si\\s+.+?\\s+entonces|en\\s*la\\s*medida\\s*(?:en\\s*)?que|siempre\\s*que|dado\\s*que|puesto\\s*que|ya\\s*que|porque|en\\s*caso\\s*de\\s*que|a\\s*condici[oó]n\\s*de"

  # ===========================================================================
  # SECCIÓN 2: SECUENCIAS VERBALES (Taxonomía de Conectores)
  # ===========================================================================
  verb_sequences:

    causal:
      description: "Relaciones directas de causa-efecto."
      connectors:
        - {pattern: "(?:conduce|conducen)\\s*a", confidence_weight: 0.95, example_context: "La capacitación de docentes conduce a una mejora en la calidad educativa."}
        - {pattern: "(?:resulta|resultan)\\s*(?:en|de)", confidence_weight: 0.94, example_context: "El fortalecimiento institucional resulta en mayor eficiencia administrativa."}
        - {pattern: "(?:genera|generan|generando)", confidence_weight: 0.93, example_context: "La construcción de vías genera mayor conectividad territorial."}
        - {pattern: "(?:produce|producen|produciendo)", confidence_weight: 0.92, example_context: "La atención integral produce mejores indicadores de salud infantil."}
        - {pattern: "(?:ocasiona|ocasionan)", confidence_weight: 0.90, example_context: "La falta de saneamiento básico ocasiona problemas de salud pública."}
        - {pattern: "(?:provoca|provocan)", confidence_weight: 0.90, example_context: "La contaminación provoca deterioro de los ecosistemas."}
        - {pattern: "(?:causa|causan|causando)", confidence_weight: 0.91, example_context: "El desplazamiento forzado causa desarraigo y pérdida de identidad."}
        - {pattern: "deriva\\s*en", confidence_weight: 0.89, example_context: "La desnutrición deriva en bajo rendimiento escolar."}
        - {pattern: "desemboca\\s*en", confidence_weight: 0.88, example_context: "La exclusión social desemboca en conflictividad."}
        - {pattern: "conlleva\\s*a", confidence_weight: 0.87, example_context: "La formalización laboral conlleva a mayor protección social."}
        - {pattern: "(?:trae|traen)\\s*como\\s*consecuencia", confidence_weight: 0.93, example_context: "La inversión en educación trae como consecuencia mayor desarrollo humano."}
        - {pattern: "(?:tiene|tienen)\\s*como\\s*efecto", confidence_weight: 0.92, example_context: "La prevención tiene como efecto la reducción de casos."}
        - {pattern: "(?:implica|implican)", confidence_weight: 0.85, example_context: "El enfoque diferencial implica atención adaptada a cada población."}
        - {pattern: "se\\s*traduce\\s*en", confidence_weight: 0.91, example_context: "El acceso a agua potable se traduce en menos enfermedades."}
        - {pattern: "(?:contribuye|contribuyen)\\s*a", confidence_weight: 0.88, example_context: "La participación ciudadana contribuye a la gobernanza territorial."}

    condicional:
      description: "Condiciones necesarias o suficientes."
      connectors:
        - {pattern: "siempre\\s*y\\s*cuando", confidence_weight: 0.87, example_context: "Se logrará la meta siempre y cuando se ejecute el 100% del presupuesto."}
        - {pattern: "si\\s*se\\s*cumple", confidence_weight: 0.86, example_context: "El resultado será efectivo si se cumple la focalización en población vulnerable."}
        - {pattern: "a\\s*condici[oó]n\\s*de(?:\\s*que)?", confidence_weight: 0.85, example_context: "Se garantiza el impacto a condición de que exista articulación intersectorial."}
        - {pattern: "en\\s*la\\s*medida\\s*(?:en\\s*)?que", confidence_weight: 0.88, example_context: "Mejorarán los indicadores en la medida que se fortalezca la capacidad institucional."}
        - {pattern: "(?:dado|dados)\\s*que", confidence_weight: 0.82, example_context: "Es viable la intervención dado que existe línea base cuantitativa."}
        - {pattern: "puesto\\s*que", confidence_weight: 0.81, example_context: "Se prioriza esta estrategia puesto que es costo-efectiva."}
        - {pattern: "siempre\\s*que", confidence_weight: 0.84, example_context: "La sostenibilidad se garantiza siempre que se transfiera capacidad local."}
        - {pattern: "cuando", confidence_weight: 0.70, example_context: "Los cambios se consolidarán cuando la comunidad se apropie del proceso."}
        - {pattern: "en\\s*caso\\s*de(?:\\s*que)?", confidence_weight: 0.78, example_context: "En caso de que surjan riesgos, se activará el plan de contingencia."}
        - {pattern: "a\\s*menos\\s*que", confidence_weight: 0.76, example_context: "El proyecto fracasará a menos que haya participación comunitaria."}
        - {pattern: "sujeto\\s*a", confidence_weight: 0.79, example_context: "La ejecución está sujeta a disponibilidad presupuestal."}
        - {pattern: "dependiendo\\s*de", confidence_weight: 0.75, example_context: "Los resultados dependerán de las condiciones territoriales."}
        - {pattern: "bajo\\s*el\\s*supuesto\\s*de(?:\\s*que)?", confidence_weight: 0.83, example_context: "El modelo funciona bajo el supuesto de corresponsabilidad."}

    temporal:
      description: "Secuencia temporal entre eslabones."
      connectors:
        - {pattern: "posteriormente|a\\s*continuaci[oó]n|luego\\s*(?:de)?\\s*(?:lo\\s*cual)?", confidence_weight: 0.82, example_context: "Se capacitará al personal; luego se implementará el sistema."}
        - {pattern: "una\\s*vez\\s*(?:que)?\\s*(?:se)?", confidence_weight: 0.85, example_context: "Una vez se entreguen los productos, se medirán los resultados."}
        - {pattern: "despu[eé]s\\s*de|al\\s*finalizar|durante\\s*(?:el|la|los)", confidence_weight: 0.80, example_context: "Durante el primer año se construirán las obras."}
        - {pattern: "en\\s*el\\s*(?:primer|segundo|tercer|cuarto)\\s*año|a\\s*partir\\s*de|antes\\s*de", confidence_weight: 0.81, example_context: "A partir de 2025 operará el nuevo modelo."}
        - {pattern: "mientras(?:\\s*tanto)?|simult[aá]neamente|de\\s*forma\\s*(?:paralela|simult[aá]nea)|previo\\s*a|hasta\\s*(?:que|alcanzar|lograr)", confidence_weight: 0.76, example_context: "Simultáneamente se ejecutarán obras y capacitación."}

    jerarquico:
      description: "Subordinación o dependencia jerárquica."
      connectors:
        - {pattern: "en\\s*el\\s*marco\\s*de|como\\s*parte\\s*de|dentro\\s*de|bajo\\s*el\\s*(?:programa|proyecto|componente)", confidence_weight: 0.86, example_context: "Actividad dentro del componente de infraestructura."}
        - {pattern: "asociado\\s*a|vinculado\\s*a|articulado\\s*con|alineado\\s*con|integrado\\s*(?:en|a)", confidence_weight: 0.84, example_context: "Meta alineada con ODS 4."}
        - {pattern: "subordinado\\s*a|dependiente\\s*de|incluido\\s*en|enmarcado\\s*en", confidence_weight: 0.82, example_context: "Proyecto incluido en el BPIN."}

    operacional:
      description: "Instrumentalidad y medios."
      connectors:
        - {pattern: "a\\s*trav[eé]s\\s*de|mediante|por\\s*medio\\s*de", confidence_weight: 0.90, example_context: "Se mejorará la cobertura mediante nuevas sedes."}
        - {pattern: "con\\s*el\\s*(?:fin|prop[oó]sito|objetivo)\\s*de|para\\s*(?:lograr|alcanzar|conseguir|obtener)", confidence_weight: 0.93, example_context: "Se implementará el sistema con el fin de mejorar trazabilidad."}
        - {pattern: "con\\s*miras\\s*a|(?:orientado|dirigido|enfocado)\\s*(?:a|en)|destinado\\s*a|encaminado\\s*a|en\\s*pro\\s*de|en\\s*aras\\s*de|en\\s*funci[oó]n\\s*de|con\\s*base\\s*en|a\\s*partir\\s*de\\s*(?:la|los)|utilizando|empleando|aplicando|implementando", confidence_weight: 0.84, example_context: "Programa orientado a garantizar derechos de primera infancia."}

  # ===========================================================================
  # SECCIÓN 3: MANEJO DE NEGACIÓN, INCERTIDUMBRE Y CORREFERENCIA
  # ===========================================================================
  discourse_controls:
    negation_patterns:
      - "no\\s+(?:se\\s+observa|se\\s+reporta|hay|existe|presenta|cuenta\\s+con)"
      - "ausencia\\s+de|carencia\\s+de|insuficiencia\\s+de"
    speculation_patterns:
      - "se\\s+(?:estima|proyecta|espera|prev[eé])"
      - "podr[ií]a|podr[ií]an|eventualmente|en\\s*hip[oó]tesis"
    coreference_links:
      pronouns: ["esto","ello","lo anterior","dicho","tal","aquello","esta acci[oó]n","esta estrategia","esta actividad","este resultado"]
      window_sentences: 2
    precedence_rules:
      - "Negación cancela coincidencias si la negación está a ≤6 tokens del núcleo del patrón."
      - "Especulación reduce peso de evidencia en 0.15 del score local."
      - "Correferencia puntúa si el antecedente pertenece a un eslabón distinto y hay conector válido."

  # ===========================================================================
  # SECCIÓN 4: PUNTAJE, UMBRALES Y FUSIÓN DE EVIDENCIA
  # ===========================================================================
  scoring:
    base_weight:
      Insumos: 0.9
      Actividades: 0.9
      Productos: 1.0
      Resultados: 1.0
      Impactos: 0.95
      Causalidad: 1.1
    context_bonus: 0.08        # si múltiples patrones compatibles co-ocurren en la ventana
    connector_bonus: 0.12      # si hay conector entre eslabones consecutivos
    evidence_decay: 0.015      # penalización por cada 10 palabras fuera de la ventana
    threshold:
      soft: 0.55               # marca para revisión humana
      hard: 0.70               # clasificación automática
    conflict_resolution:
      - "Si un fragmento puntúa como Producto y Resultado, prevalece Resultado si hay 'cambio' + indicador."
      - "Si Actividad y Producto colisionan, prevalece Producto con unidad de medida."
      - "Impacto prevalece sobre Resultado si hay mención a ODS/índices de desarrollo/‘largo plazo’."
    chain_consistency:
      require_order: true       # preferir secuencias Insumo→Actividad→Producto→Resultado→Impacto
      allow_gaps: true          # tolera eslabones ausentes
      gap_penalty: 0.05

  # ===========================================================================
  # SECCIÓN 5: LÉXICOS SECTORIALES (para desambiguación leve)
  # ===========================================================================
  sector_lexicons:
    salud: ["mortalidad","morbilidad","atención primaria","hospital","EPS","ESE","vacunación","materna","infantil","SISPRO"]
    educacion: ["docentes","IE","jornada escolar","calidad educativa","ICFES","cobertura neta","deserción"]
    infraestructura: ["vías","placa huella","acueducto","alcantarillado","PTAR","saneamiento","kilómetros","hectáreas","obra civil"]
    seguridad: ["convivencia","homicidio","hurto","SIEDCO","comisar[ií]a","violencia intrafamiliar"]
    social: ["SISBEN","transferencias","hogares","vulnerabilidad","enfoque diferencial","población víctima","UARIV"]
    ambiente: ["reforestación","calidad del aire","residuos sólidos","riesgo","amenaza","adaptación climática","resiliencia"]

  # ===========================================================================
  # SECCIÓN 6: VALIDACIONES Y GUARDRAILS ADICIONALES
  # ===========================================================================
  validations:
    date_guard:
      pattern: "(?:19\\d{2}|20\\d{2})"
      reject_future_after: 2035
    money_guard:
      min_value_cop: 100000     # descarta cifras ínfimas como presupuesto municipal
    unit_guard:
      require_unit_for_producto: true
    evidence_requirements:
      producto: ["unidad_o_indicador","medio_verificacion?"]
      resultado: ["indicador_o_cambio"]
      impacto: ["largo_plazo_o_indice"]

  # ===========================================================================
  # SECCIÓN 7: SALIDA ESTRUCTURADA
  # ===========================================================================
  output_schema:
    type: "object"
    fields:
      - {name: "eslabon", type: "enum", values: ["Insumos","Actividades","Productos","Resultados","Impactos","Causalidad"]}
      - {name: "texto", type: "string"}
      - {name: "span", type: "tuple[int,int]"}   # offsets de caracteres
      - {name: "score", type: "float"}
      - {name: "patrones", type: "array[string]"}
      - {name: "conectores", type: "array[string]"}
      - {name: "contexto", type: "string"}
      - {name: "enlaces", type: "array[link]"}   # {from_eslabon,to_eslabon,conector,score}
      - {name: "sector_probable", type: "string?"}
      - {name: "flags", type: "array[string]"}   # negación, especulación, correferencia

  # ===========================================================================
  # SECCIÓN 8: NOTAS DE USO Y OPERACIÓN
  # ===========================================================================
  usage_notes:
    prioridad_de_patrones: >
      Evaluar primero patrones específicos con unidades/indicadores. El peso de confianza de
      cada conector ajusta el score local. Combinar múltiples patrones aumenta la confianza.
    sensibilidad_a_contexto: >
      Evaluar ventanas ±50 palabras (máx. 120) y aplicar correferencia a 2 oraciones.
      El mismo patrón puede mapear distinto según unidades, indicadores y conectores cercanos.
    robustez: >
      Regex toleran variaciones ortográficas y tildes. La implementación debe ser case-insensitive,
      con normalización de números, porcentajes y moneda COP.
    extensibilidad: >
      Añadir nuevos patrones con trazabilidad (semver). Registrar pruebas y corpus de verificación.
    auditoria: >
      Conservar huella de patrones que disparan cada clasificación y su score intermedio.

  # ===========================================================================
  # SECCIÓN 9: PRUEBAS MÍNIMAS (UNIT SNIPPETS)
  # ===========================================================================
  tests:
    - name: "insumo_linea_base"
      text: "Según el DANE (2023), la línea base de pobreza extrema es 14,2%."
      expect: {eslabon: "Insumos", min_score: 0.70}
    - name: "actividad_capacitacion"
      text: "Se realizarán 12 talleres de sensibilización a cargo de la Secretaría de Salud."
      expect: {eslabon: "Actividades", min_score: 0.70}
    - name: "producto_entregables"
      text: "Meta de producto: 500 personas capacitadas; fuente de verificación: listados de asistencia."
      expect: {eslabon: "Productos", min_score: 0.75}
    - name: "resultado_cambio_indicador"
      text: "La tasa de embarazo adolescente se reduce al 14% en 2027."
      expect: {eslabon: "Resultados", min_score: 0.75}
    - name: "impacto_ods"
      text: "Contribución a ODS 3 y mejora del IDH municipal en el largo plazo."
      expect: {eslabon: "Impactos", min_score: 0.75}
    - name: "causalidad_si_entonces"
      text: "Si se implementa el modelo de atención, entonces disminuye la mortalidad materna."
      expect: {eslabon: "Causalidad", min_score: 0.80}
    - name: "negacion_guardrail"
      text: "No se observa línea base para 2024."
      expect: {eslabon: "Insumos", min_score: 0.55, flag: "negación"}  # marcar para revisión
    - name: "desambiguacion_producto_vs_resultado"
      text: "Se entregaron 3 sedes nuevas, lo cual permite ampliar la cobertura."
      expect_chain:
        - {eslabon: "Productos"}
        - {eslabon: "Causalidad"}
        - {eslabon: "Resultados"}

# =============================================================================
# FIN DE CONFIGURACIÓN
# =============================================================================
